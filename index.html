<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Escalas da Igreja</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <!-- FullCalendar -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>

  <style>
    :root {
      --azul-escuro: #0a2540;
      --azul-medio: #1e40af;
      --azul-claro: #e0ecff;
      --cinza: #f4f6f8;
    }
    body { margin:0; font-family:'Segoe UI',Roboto,sans-serif; background:var(--cinza); }
    header { background:linear-gradient(135deg,var(--azul-escuro),var(--azul-medio)); color:#fff; padding:20px; text-align:center; }
    main { max-width:1100px; margin:30px auto; padding:20px; }
    .card { background:#fff; border-radius:12px; padding:20px; box-shadow:0 10px 25px rgba(0,0,0,.05); margin-bottom:30px; }
    h2 { color:var(--azul-medio); margin-top:0; }
    table { width:100%; border-collapse:collapse; }
    th,td { padding:12px; border-bottom:1px solid #ddd; }
    th { background:var(--azul-claro); }
    button { background:var(--azul-medio); color:#fff; border:none; border-radius:8px; padding:8px 14px; cursor:pointer; }
    button:hover { background:#172554; }
    form input { padding:8px; margin:5px; }

    .fc { background:#fff; border-radius:12px; padding:10px; }
    .fc-button { background:var(--azul-medio)!important; border:none!important; }

    /* MODAL */
    .modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: #fff;
      border-radius: 12px;
      padding: 20px;
      width: 90%;
      max-width: 400px;
    }
    .modal-content h3 { margin-top: 0; color: var(--azul-medio); }
    .close { float:right; cursor:pointer; font-size:18px; }
  </style>
</head>
<body>

<header>
  <h1>üìÖ Escalas da Igreja</h1>
</header>

<main>

  <div class="card">
    <button onclick="mostrarTabela()">Tabela</button>
    <button onclick="mostrarCalendario()">Calend√°rio</button>
  </div>

  <div class="card">
    <h2>‚ûï Nova Escala</h2>
    <form id="formEscala">
      <input type="date" id="data" required>
      <input type="text" id="pregador" placeholder="Pregador" required>
      <input type="text" id="cantor" placeholder="Cantor / Grupo">
      <input type="text" id="sonoplasta" placeholder="Sonoplasta">
      <input type="text" id="telefone" placeholder="WhatsApp">
      <button type="submit">Salvar</button>
    </form>
  </div>

  <div class="card" id="secaoTabela">
    <h2>üìã Pr√≥ximas Escalas</h2>
    <table>
      <thead>
        <tr><th>Data</th><th>Pregador</th><th>Cantor</th><th>Sonoplasta</th></tr>
      </thead>
      <tbody id="listaEscalas"></tbody>
    </table>
  </div>

  <div class="card" id="secaoCalendario" style="display:none">
    <h2>üóìÔ∏è Calend√°rio</h2>
    <div id="calendar"></div>
  </div>

</main>

<!-- MODAL DETALHES -->
<div class="modal" id="modalDetalhes">
  <div class="modal-content">
    <span class="close" onclick="fecharModal()">‚úñ</span>
    <h3>üìå Detalhes da Escala</h3>
    <p><strong>Data:</strong> <span id="mData"></span></p>
    <p><strong>Pregador:</strong> <span id="mPregador"></span></p>
    <p><strong>Cantor:</strong> <span id="mCantor"></span></p>
    <p><strong>Sonoplasta:</strong> <span id="mSonoplasta"></span></p>
    <p><strong>WhatsApp:</strong> <span id="mTelefone"></span></p>
  </div>
</div>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAUQeo8pNtkySgK55Bik59sHwvAaxVsS6w",
    authDomain: "escala-santa-helena.firebaseapp.com",
    projectId: "escala-santa-helena",
    storageBucket: "escala-santa-helena.firebasestorage.app",
    messagingSenderId: "853456405347",
    appId: "1:853456405347:web:9b85caee37bbf5a5c10956"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.firestore();

  const lista = document.getElementById('listaEscalas');
  const calendarEl = document.getElementById('calendar');
  let calendar;

  async function carregarEscalas() {
    lista.innerHTML = '';
    const snap = await db.collection('escalas').orderBy('data').get();
    const eventos = [];

    snap.forEach(doc => {
      const e = doc.data();
      lista.innerHTML += `<tr><td>${e.data}</td><td>${e.pregador}</td><td>${e.cantor||'-'}</td><td>${e.sonoplasta||'-'}</td></tr>`;

      eventos.push({
        title: 'üé§ ' + e.pregador,
        start: e.data,
        extendedProps: e
      });
    });

    if (calendar) {
      calendar.removeAllEvents();
      calendar.addEventSource(eventos);
    }
  }

  document.getElementById('formEscala').addEventListener('submit', async e => {
    e.preventDefault();
    await db.collection('escalas').add({
      data: data.value,
      pregador: pregador.value,
      cantor: cantor.value,
      sonoplasta: sonoplasta.value,
      telefone: telefone.value,
      criadoEm: firebase.firestore.FieldValue.serverTimestamp()
    });
    e.target.reset();
    carregarEscalas();
  });

  function mostrarCalendario() {
    secaoTabela.style.display='none';
    secaoCalendario.style.display='block';

    if (!calendar) {
      calendar = new FullCalendar.Calendar(calendarEl, {
        initialView: 'dayGridMonth',
        locale: 'pt-br',
        eventClick: function(info) {
          const e = info.event.extendedProps;
          document.getElementById('mData').innerText = info.event.startStr;
          document.getElementById('mPregador').innerText = e.pregador || '-';
          document.getElementById('mCantor').innerText = e.cantor || '-';
          document.getElementById('mSonoplasta').innerText = e.sonoplasta || '-';
          document.getElementById('mTelefone').innerText = e.telefone || '-';
          document.getElementById('modalDetalhes').style.display = 'flex';
        }
      });
      calendar.render();
    }
    carregarEscalas();
  }

  function mostrarTabela() {
    secaoCalendario.style.display='none';
    secaoTabela.style.display='block';
  }

  function fecharModal() {
    document.getElementById('modalDetalhes').style.display = 'none';
  }

  carregarEscalas();
</script>

</body>
</html>
