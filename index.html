<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Escalas da Igreja</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<!-- FullCalendar -->
<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>

<style>
:root{
  --azul:#2563eb;
  --azul-claro:#e0ecff;
  --cinza:#f4f6f8;
  --cinza-texto:#6b7280;
}

body{
  margin:0;
  font-family:'Segoe UI',Roboto,sans-serif;
  background:var(--cinza);
}

header{
  background:linear-gradient(135deg,#3b82f6,#60a5fa);
  color:#fff;
  padding:24px;
  text-align:center;
}

main{
  max-width:1100px;
  margin:30px auto;
  padding:20px;
}

.card{
  background:#fff;
  border-radius:16px;
  padding:30px;
  box-shadow:0 20px 40px rgba(0,0,0,.08);
  margin-bottom:30px;
}

h2{color:var(--azul);margin-top:0}

/* Segmented Control */
.segmented{
  display:flex;
  justify-content:center;
  margin-bottom:10px;
}
.segmented button{
  border:none;
  padding:10px 20px;
  background:#e5e7eb;
  cursor:pointer;
  font-weight:500;
}
.segmented button:first-child{
  border-radius:10px 0 0 10px;
}
.segmented button:last-child{
  border-radius:0 10px 10px 0;
}
.segmented button.active{
  background:var(--azul);
  color:#fff;
}

/* Tabela */
table{width:100%;border-collapse:collapse}
th,td{padding:12px;border-bottom:1px solid #ddd}
th{background:var(--azul-claro)}

/* Calend√°rio */
.fc{
  background:#fff;
  border-radius:16px;
  padding:20px;
}

.fc-daygrid-day.fc-day-today .fc-daygrid-day-number{
  background:var(--azul);
  color:#fff;
  border-radius:50%;
  padding:6px 10px;
}

.fc-daygrid-event{
  border-radius:10px;
  padding:3px 6px;
  cursor:pointer;
}

.fc-col-header-cell-cushion{
  text-transform:uppercase;
  color:var(--cinza-texto);
  font-size:12px;
}

/* Modal */
.modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.5);
  justify-content:center;
  align-items:center;
  z-index:9999;
}

.modal-content{
  background:#fff;
  border-radius:16px;
  padding:24px;
  width:90%;
  max-width:420px;
  position:relative;
}

.modal-content h3{
  margin-top:0;
  color:var(--azul);
  text-align:center;
}

.edit-btn{
  position:absolute;
  top:12px;
  right:12px;
  background:none;
  border:none;
  font-size:18px;
  cursor:pointer;
  color:var(--azul);
}

.form-group{
  display:flex;
  flex-direction:column;
  gap:5px;
  margin-bottom:12px;
}

.form-group input{
  padding:10px;
  border-radius:8px;
  border:1px solid #ccc;
}

.readonly input{
  background:#f1f5f9;
}

.modal-actions{
  display:flex;
  justify-content:space-between;
  gap:10px;
  margin-top:15px;
}

.btn-danger{
  background:#b91c1c;
  color:#fff;
  border:none;
  border-radius:8px;
}
</style>
</head>

<body>

<header>
<h1>üìÖ Escalas da Igreja</h1>
</header>

<main>

<div class="card">
  <div class="segmented">
    <button id="btnTabela" class="active" onclick="mostrarTabela()">Tabela</button>
    <button id="btnCalendario" onclick="mostrarCalendario()">Calend√°rio</button>
  </div>
</div>

<div class="card" id="secaoTabela">
<h2>üìã Pr√≥ximas Escalas</h2>
<table>
<thead>
<tr><th>Data</th><th>Culto</th><th>Pregador</th><th>Cantor</th></tr>
</thead>
<tbody id="listaEscalas"></tbody>
</table>
</div>

<div class="card" id="secaoCalendario" style="display:none">
<h2>üóìÔ∏è Calend√°rio</h2>
<div id="calendar"></div>
</div>

</main>

<!-- MODAL -->
<div class="modal" id="modal">
<div class="modal-content readonly" id="modalContent">
<h3 id="modalTitulo">Escala</h3>
<button class="edit-btn" id="btnEditar">‚úèÔ∏è</button>

<div class="form-group">
<input type="text" id="mCulto" placeholder="Nome do Culto">
</div>
<div class="form-group">
<input type="date" id="mData">
</div>
<div class="form-group">
<input type="text" id="mPregador" placeholder="Pregador">
</div>
<div class="form-group">
<input type="text" id="mCantor" placeholder="Cantor">
</div>

<div class="modal-actions">
<button onclick="salvarEscala()">Salvar</button>
<button class="btn-danger" onclick="excluirEscala()">Excluir</button>
<button onclick="fecharModal()">Fechar</button>
</div>
</div>
</div>

<script>
const firebaseConfig = {
 apiKey:"AIzaSyAUQeo8pNtkySgK55Bik59sHwvAaxVsS6w",
 authDomain:"escala-santa-helena.firebaseapp.com",
 projectId:"escala-santa-helena"
};

firebase.initializeApp(firebaseConfig);
const db=firebase.firestore();

let calendar,escalaId=null;

async function carregar(){
 lista.innerHTML='';
 const snap=await db.collection('escalas').get();
 const eventos=[];
 snap.forEach(d=>{
  const e=d.data();
  lista.innerHTML+=`<tr><td>${e.data}</td><td>${e.culto}</td><td>${e.pregador}</td><td>${e.cantor||'-'}</td></tr>`;
  eventos.push({title:e.culto,start:e.data,extendedProps:{...e,id:d.id}});
 });
 if(calendar){
  calendar.removeAllEvents();
  calendar.addEventSource(eventos);
 }
}

function mostrarCalendario(){
 btnTabela.classList.remove('active');
 btnCalendario.classList.add('active');
 secaoTabela.style.display='none';
 secaoCalendario.style.display='block';

 if(!calendar){
  calendar=new FullCalendar.Calendar(calendarEl,{
   initialView:'dayGridMonth',
   locale:'pt-br',
   dateClick:i=>abrir({data:i.dateStr}),
   eventClick:i=>abrir(i.event.extendedProps)
  });
  calendar.render();
 }
 carregar();
}

function mostrarTabela(){
 btnCalendario.classList.remove('active');
 btnTabela.classList.add('active');
 secaoCalendario.style.display='none';
 secaoTabela.style.display='block';
}

function abrir(d={}){
 escalaId=d.id||null;
 modal.style.display='flex';
 mCulto.value=d.culto||'';
 mData.value=d.data||'';
 mPregador.value=d.pregador||'';
 mCantor.value=d.cantor||'';
}

async function salvarEscala(){
 const dados={
  culto:mCulto.value,
  data:mData.value,
  pregador:mPregador.value,
  cantor:mCantor.value
 };
 escalaId
 ? await db.collection('escalas').doc(escalaId).update(dados)
 : await db.collection('escalas').add(dados);
 fecharModal();
 carregar();
}

async function excluirEscala(){
 if(escalaId && confirm('Excluir esta escala?')){
  await db.collection('escalas').doc(escalaId).delete();
  fecharModal();
  carregar();
 }
}

function fecharModal(){
 modal.style.display='none';
 escalaId=null;
}

carregar();
</script>
</body>
</html>
